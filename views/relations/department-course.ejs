<%- include('../partials/header'); -%>
  <link rel="stylesheet" href="/css/department-course.css">
  <script src="/modules/@shopify/draggable/lib/draggable.bundle.js"></script>

  <div class="d-flex flex-row flex-wrap justify-content-center w-100 h-100">
  	<div class="grid flex-start-content department-courses">
      <div>
        <p>Uncategorized:</p>
        <div
        name="sortableCards"
        class="
          grid
          flex-start-content
          disable-marker
          cards clickable
          sortable-animation
        "
        style="min-height: 500px;"
        sortable>
          <% courses.forEach(function(course) { %>
            <% if (course.department === undefined) { %>
              <div sortItem class="course" id=<%=course.code%>>
                <p> <%= course.code %> </p>
              </div>
            <% } %>
          <% }); %>
        </div>

      </div>

      <% departments.forEach(function(department) { %>
        <div id=<%= department._id %>>
          <p>Department: <%= department.name %> </p>
      		<div
      		name="sortableCards"
      		class="
      			grid
      			flex-start-content
      			disable-marker
      			cards clickable
      			sortable-animation
      		"
          style="min-height: 500px;"
      		sortable>
            <% courses.forEach(function(course) { %>
              <% if (course.department) { %>
                <% if (course.department.toString() === department._id.toString()) { %>
            			<div sortItem class="course" id=<%=course.code%>>
            				<p> <%= course.code %> </p>
            			</div>
                <% } %>
              <% } %>
            <% }); %>
      		</div>
        </div>

      <% }); %>
  	</div>
  </div>

  <button class="m-3 btn btn-sm btn-success" type="button" onclick="submitChanges()" name="save">Save Changes</button> <br/>

  <script>
    var departmentsObj = {
      "all": []
    };

    var data = {
      departments: departmentsObj
    };

    courses = <%- JSON.stringify(courses) %>;
    departments = <%- JSON.stringify(departments) %>;

    courses.forEach(function(course, index) {
      let courseInfo = {
        course: course.code,
        color: "#ef9a9a"
      };
      departmentsObj.all.push(courseInfo);
    });

    departments.forEach(function(department, index) {
      let departmentInfo = {
        [department.name]: []
      }

      Object.assign(departmentsObj, departmentInfo);
    });

    const sortable = new Draggable.Sortable(
    	document.querySelectorAll('[sortable]'), {
    		draggable: '[sortItem]',
    		delay: 0,
    	}
    );

    function submitChanges() {
      var courses = document.querySelectorAll(".course");

      courses.forEach(function(course) {
        console.log(course);
      });
    }
  </script>

<%- include('../partials/footer'); -%>
